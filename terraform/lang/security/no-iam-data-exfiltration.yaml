rules:
- id: no-iam-data-exfiltration.yaml
  patterns:
  - patterns:
    - pattern-inside: |
        data "..." "..." {
          ...
          statement {
            ...
            resources = ["*"]
            ...
          }
          ...
        }
    - pattern-either:
      - pattern: |
          actions = [..., "s3:GetObject", ...]
      - pattern: |
          actions = [..., "ssm:GetParameter*", ...]
      - pattern: |
          actions = [..., "secretsmanager:GetSecretValue", ...]
      - pattern: |
          actions = [..., "rds:CopyDBSnapshot", ...]
      - pattern: |
          actions = [..., "rds:CreateDBSnapshot", ...]
  message: |
    Certain IAM actions such as GetObject, GetParameter, etc should not be allowed without resource restrictions.
    These actions have a long history of customer data leaks or can be used to access secrets or database contents.
  metadata:
    references:
    - https://docs.bridgecrew.io/docs/ensure-iam-policies-do-not-allow-data-exfiltration
    - https://github.com/bridgecrewio/checkov/blob/master/checkov/terraform/checks/data/aws/IAMDataExfiltration.py
    category: security
    technology:
    - terraform
  paths:
    include:
    - '*.tf'
  languages: [generic]
  severity: WARNING
